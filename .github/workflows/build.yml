name: 'Build'

on:
 push:

jobs:
 build:
  name: Build
  runs-on: windows-latest
  strategy:
   fail-fast: false
   matrix:
    node: ['lts/*']
    go: ['stable']
  steps:
   - name: 📦 Checkout code
     uses: actions/checkout@v4
   - name: 🛠️ Setup Go ${{ matrix.go }}
     uses: actions/setup-go@v5
     with:
      go-version: ${{ matrix.go }}
   - name: 🏗️ Build Go binary
     run: |
      go version
      go build -ldflags="-s -w" -o out/DPUnlock.exe .
   - name: 🛠️ Setup PNPM
     uses: pnpm/action-setup@v4
     with:
      version: 10
      standalone: true
   - name: 🛠️ Setup Node.js ${{ matrix.node }}
     uses: actions/setup-node@v4
     with:
      node-version: ${{ matrix.node }}
      cache: 'pnpm'
      cache-dependency-path: 'out/typescript/pnpm-lock.yaml'
   - name: 📦 Install dependencies
     working-directory: out/typescript
     run: pnpm install && pnpm install -g tsx
   - name: 🚀 Run Test
     working-directory: out/typescript
     run: pnpm tsx index
   - name: 📦 Archive artifacts
     uses: actions/upload-artifact@v4
     with:
      name: build
      path: |
       ./out/*
